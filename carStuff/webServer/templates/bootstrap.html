<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <style>
      canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
      </style>
    <!-- Bootstrap CSS -->
    <script src="{{ url_for('static', filename='chart/Chart.js') }}"></script>
    <script src="{{ url_for('static', filename='chart/utils.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Hello, world!</title>
  </head>
  <body>
      <button id="addDataAccel">Add Data</button>
      <div class="container-fluid">
        <!-- <div> -->
          <div class="row">
              <div class="col-md">
            <h1 class="white-text">Throttle</h1>
            <div style="width:75%;">
              <canvas id="canvasThrottle"></canvas>
            </div>
            <br>
            <br>
        </div>

        <div class="col-md">
          <div class="row">
            <div class="col-3">
              <img id="leftDisabled" style="display: inline;"src="{{ url_for('static', filename='img/icon/leftDisabled.png') }}">
              <img id="leftEnabled" style="display: none;"src="{{ url_for('static', filename='img/icon/leftEnabled.png') }}">
            </div>
            <div class="col-3">
              <img id="straightDisabled" style="display: inline;"src="{{ url_for('static', filename='img/icon/straightDisabled.png') }}">
              <img id="straightEnabled" style="display: none;"src="{{ url_for('static', filename='img/icon/straightEnabled.png') }}">
            </div>
            <div class="col-3">
                <img id="rightDisabled" style="display: inline;" src="{{ url_for('static', filename='img/icon/rightDisabled.png') }}">
                <img id="rightEnabled" style="display: none;" src="{{ url_for('static', filename='img/icon/rightEnabled.png') }}">
            </div>
          </div>
          <div class="row">
            <span id="proximity">?</span> cm
          </div>
        </div>
          <div class="col-md">
        <h1 class="white-text">Accelorometer</h1>
        <div style="width:75%;">
          <canvas id="canvasAccel"></canvas>
        </div>
        <br>
        <br>

        </div>
        </div>
        </div>










<script>
    var animationTime = 500;
        var configThrottle = {
        type: 'line',
        data: {
            datasets: [{
            // label: 'Throttle',
            backgroundColor: window.chartColors.red,
            borderColor: window.chartColors.red,
            data: [

            ],
            fill: false,
          }]
        },
        options: {
          animation: {
            duration : animationTime
          },
          elements: {
                    point:{
                        radius: 0
                    }
                },
          responsive: true,
          title: {
            display: false,
            text: 'Throttle'
          },
          legend: {
            display: false
          },
          scales: {
            xAxes: [{
              display: false,
              scaleLabel: {
                display: true,
                labelString: 'Time'
              }
            }],
            yAxes: [{
              display: true

              ,scaleLabel: {
                display: false,
                labelString: 'Value'
              }
              ,ticks: {
                fontColor: window.chartColors.white,
              }
              ,gridLines: {
                color: window.chartColors.green,
                lineWidth: 0.5
              }
            }]
          }

            
        }
      };
  
      window.onload = function() {
        var ctxThrottle = document.getElementById('canvasThrottle').getContext('2d');
        window.myLineThrottle = new Chart(ctxThrottle, configThrottle);
        var ctxAccel = document.getElementById('canvasAccel').getContext('2d');
        window.myLineAccel = new Chart(ctxAccel, configAccel);
      };
  

  var configAccel = {
    type: 'line',
    data: {
      datasets: [{
        backgroundColor: window.chartColors.white,
        borderColor: window.chartColors.white,
        data: [

        ],
        fill: false,
      }
      ,{
        backgroundColor: window.chartColors.red,
        borderColor: window.chartColors.red,
        data: [

        ],
        fill: false,
      }
      ,{
        backgroundColor: window.chartColors.black,
        borderColor: window.chartColors.black,
        data: [

        ],
        fill: false,
      }
      ]
    },
    options: {
      animation: {
        duration : animationTime/3
      },
      elements: {
                point:{
                    radius: 0
                }
            },
      responsive: true,
      title: {
        display: false,
        text: 'Accel'
      },
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          display: false,
          scaleLabel: {
            display: true,
            labelString: 'Time'
          }
        }],
        yAxes: [{
          display: true,
          scaleLabel: {
            display: false,
            labelString: 'Value'
          }
          ,ticks: {
                fontColor: window.chartColors.white,
              }
              ,gridLines: {
                color: window.chartColors.white,
                lineWidth: 0.5
              }
        }]
      }

        
    }
  };
  var colorNames = Object.keys(window.chartColors);

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  document.getElementById('addDataAccel').addEventListener('click', async function() {
      // for (i = 0; i < 10; i++) { 
    while (true){
      await sleep(100);
      $.getJSON("{{ url_for('add_numbers') }}", {
        a: $('input[name="a"]').val(),
        b: $('input[name="b"]').val()
      }, function(data) {
        if (configThrottle.data.datasets.length > 0) {
              configThrottle.data.labels.push(data.throttle);

              configThrottle.data.datasets.forEach(function(dataset) {
                dataset.data.push(data.throttle);

                if (dataset.data.length > 100){
                  configThrottle.data.labels.shift(); // remove the label first
                  dataset.data.shift()
                  // dataset.data.splice(0, 1);
                }
                
              });
              window.myLineThrottle.update();
              
            }
        //Accel stuff
        var rowsToShow= 30;
        if (configAccel.data.datasets.length > 0) {
          if (configAccel.data.labels.length <= rowsToShow){
            configAccel.data.labels.push(data.accel[0]);
          } else {
            configAccel.data.labels.shift(); // remove the label first
          }
          var i = 0
          configAccel.data.datasets.forEach(function(dataset) {
              dataset.data.push(data.accel[i++]);

            if (dataset.data.length > rowsToShow){
              dataset.data.shift()
            }
            
          });

          window.myLineAccel.update();
        }
        $("#proximity").text(data.proximity);

        if (data.steering < 0){
          document.getElementById("leftEnabled").style.display = "inline";
          document.getElementById("leftDisabled").style.display = "none";
          document.getElementById("straightEnabled").style.display = "none";
          document.getElementById("straightDisabled").style.display = "inline";
          document.getElementById("rightEnabled").style.display = "none";
          document.getElementById("rightDisabled").style.display = "inline";
        } else if (data.steering > 0){
          document.getElementById("leftEnabled").style.display = "none";
          document.getElementById("leftDisabled").style.display = "inline";
          document.getElementById("straightEnabled").style.display = "none";
          document.getElementById("straightDisabled").style.display = "inline";
          document.getElementById("rightEnabled").style.display = "inline";
          document.getElementById("rightDisabled").style.display = "none";
        } else {
          document.getElementById("leftEnabled").style.display = "none";
          document.getElementById("leftDisabled").style.display = "inline";
          document.getElementById("straightEnabled").style.display = "inline";
          document.getElementById("straightDisabled").style.display = "none";
          document.getElementById("rightEnabled").style.display = "none";
          document.getElementById("rightDisabled").style.display = "inline";
        }
        // document.getElementById("MyElement").classList.add('MyClass');

        // document.getElementById("MyElement").classList.remove('MyClass');
      });
    }
    return false;
  });

</script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="{{ url_for('static', filename='jquery/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='popper/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap/bootstrap.min.js') }}"></script>
  </body>
</html>