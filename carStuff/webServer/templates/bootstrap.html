<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <style>
      canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
      </style>
    <!-- Bootstrap CSS -->
    <script src="{{ url_for('static', filename='chart/Chart.js') }}"></script>
    <script src="{{ url_for('static', filename='chart/utils.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/bootstrap.min.css') }}">

    <title>Hello, world!</title>
  </head>
  <body>
      <div class="container-fluid">
        <!-- <div> -->
          <div class="row">
              <div class="col-md">
            <h1>Hello, world!</h1>
            <div style="width:75%;">
              <canvas id="canvasThrottle"></canvas>
            </div>
            <br>
            <br>
            <button id="addDataThrottle">Add Data</button>
        </div>

        <div class="col-md">
          </div>
          <div class="col-md">
        <h1>Hello, world!</h1>
        <div style="width:75%;">
          <canvas id="canvasAccel"></canvas>
        </div>
        <br>
        <br>
        <button id="addDataAccel">Add Data</button>
        </div>
        </div>
        </div>










<script>
        var configThrottle = {
        type: 'line',
        data: {
            datasets: [{
            // label: 'Throttle',
            backgroundColor: window.chartColors.red,
            borderColor: window.chartColors.red,
            data: [

            ],
            fill: false,
          }]
        },
        options: {
          animation: {
            duration : 1000
          },
          elements: {
                    point:{
                        radius: 0
                    }
                },
          responsive: true,
          title: {
            display: false,
            text: 'Throttle'
          },
          legend: {
            display: false
          },
          scales: {
            xAxes: [{
              display: false,
              scaleLabel: {
                display: true,
                labelString: 'Time'
              }
            }],
            yAxes: [{
              display: true,
              scaleLabel: {
                display: false,
                labelString: 'Value'
              }
            }]
          }

            
        }
      };
  
      window.onload = function() {
        var ctxThrottle = document.getElementById('canvasThrottle').getContext('2d');
        window.myLineThrottle = new Chart(ctxThrottle, configThrottle);
        var ctxAccel = document.getElementById('canvasAccel').getContext('2d');
        window.myLineAccel = new Chart(ctxAccel, configAccel);
      };
  

      // document.getElementById('addDataThrottle').addEventListener('click', async function() {
      //     // for (i = 0; i < 10; i++) { 
      //   while (true){
      //     await sleep(100);
      //     $.getJSON("{{ url_for('add_numbers') }}", {
      //       a: $('input[name="a"]').val(),
      //       b: $('input[name="b"]').val()
      //     }, function(data) {
      //       if (configThrottle.data.datasets.length > 0) {
      //         configThrottle.data.labels.push(data.result);

      //         configThrottle.data.datasets.forEach(function(dataset) {
      //           dataset.data.push(data.result);

      //           if (dataset.data.length > 100){
      //             configThrottle.data.labels.shift(); // remove the label first
      //             dataset.data.shift()
      //             // dataset.data.splice(0, 1);
      //           }
                
      //         });
      //         window.myLineThrottle.update();
              
      //       }
      //       // dataset.data.push(data.result);
      //     });
      //   }
      //   return false;
      // });

  var configAccel = {
    type: 'line',
    data: {
      // labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
      datasets: [{
        backgroundColor: window.chartColors.blue,
        borderColor: window.chartColors.blue,
        data: [

        ],
        fill: false,
      },
      {
        backgroundColor: window.chartColors.green,
        borderColor: window.chartColors.green,
        data: [

        ],
        fill: false,
      }]
    },
    options: {
      animation: {
        duration : 1000
      },
      elements: {
                point:{
                    radius: 0
                }
            },
      responsive: true,
      title: {
        display: false,
        text: 'Throttle'
      },
      legend: {
        display: false
      },
      scales: {
        xAxes: [{
          display: false,
          scaleLabel: {
            display: true,
            labelString: 'Time'
          }
        }],
        yAxes: [{
          display: true,
          scaleLabel: {
            display: false,
            labelString: 'Value'
          }
        }]
      }

        
    }
  };
  var colorNames = Object.keys(window.chartColors);

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  document.getElementById('addDataAccel').addEventListener('click', async function() {
      // for (i = 0; i < 10; i++) { 
    while (true){
      await sleep(100);
      $.getJSON("{{ url_for('add_numbers') }}", {
        a: $('input[name="a"]').val(),
        b: $('input[name="b"]').val()
      }, function(data) {
        if (configThrottle.data.datasets.length > 0) {
              configThrottle.data.labels.push(data.result);

              configThrottle.data.datasets.forEach(function(dataset) {
                dataset.data.push(data.result);

                if (dataset.data.length > 100){
                  configThrottle.data.labels.shift(); // remove the label first
                  dataset.data.shift()
                  // dataset.data.splice(0, 1);
                }
                
              });
              window.myLineThrottle.update();
              
            }
        if (configAccel.data.datasets.length > 0) {
          if (configAccel.data.labels.length <= 100){
            configAccel.data.labels.push(data.result);
          }
          if (configAccel.data.datasets[0].data.length > 100){
              configAccel.data.labels.shift(); // remove the label first
          }
          configAccel.data.datasets.forEach(function(dataset) {
            if (dataset == configAccel.data.datasets[0]){
              dataset.data.push(data.result);
            } else {
              dataset.data.push(-1*data.result + 180);
            }

            if (dataset.data.length > 100){
              dataset.data.shift()
            }
            
          });

          window.myLineAccel.update();
        }
        // dataset.data.push(data.result);
      });
    }
    return false;
  });

</script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="{{ url_for('static', filename='jquery/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='popper/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap/bootstrap.min.js') }}"></script>
  </body>
</html>